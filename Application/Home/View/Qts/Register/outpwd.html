<include file="Base:header" />
<title data-n-head="true">{$Think.lang.re_pwd}</title>
<link href="__PUBLIC__/Qts/Home/css/common.css" rel="stylesheet">
<style data-vue-ssr-id="3e9fb98a:0 b282aea2:0">.login_content[data-v-221d2783] {
	padding: 0 .2rem
}

h2[data-v-221d2783] {
	font-size: 30px;
	color: #999;
	line-height: .6rem;
	margin-bottom: .2rem
}

.captcha[data-v-221d2783] {
	width: .89rem;
	height: .28rem;
	color: #ddd;
	position: absolute;
	right: .01rem;
	top: .12rem;
	text-align: center;
	line-height: .28rem;
	border-radius: .01rem
}

label[data-v-221d2783] {
	position: relative;
	display: block
}

.login_form[data-v-221d2783] {
	margin: 0 auto;
	text-align: center
}

input[data-v-221d2783] {
	width: 100%;
	height: .48rem;
	margin-top: .04rem;
	/*background-color: #fff;*/
	border-bottom: .01rem solid #444;
	color: #999;
}

.login_btn[data-v-221d2783] {
	position: relative;
	margin-top: .32rem
}

.login_btn .activeColor[data-v-221d2783] {
	/*background-image: -o-linear-gradient(319deg, #1254a8 0, #0c62c1 100%);*/
	/*background-image: linear-gradient(-229deg, #1254a8, #0c62c1)*/
	background: #ffbf23;
}

span[data-v-221d2783] {
	position: relative;
	display: block;
	margin: 0 .03rem 0 .04rem;
	text-align: center;
	line-height: .4rem;
	background-color: #cecfd1;
	border-radius: .05rem;
	font-size: .16rem;
	color: #000;
	letter-spacing: 0
}

#header[data-v-7fd5ad9d] {
	width: 100%;
	text-align: center;
	color: #012057;
	z-index: 4;
	top: 0
}

#header h3[data-v-7fd5ad9d] {
	position: relative;
	height: .5rem;
	line-height: .5rem;
	margin: 0;
	font-size: .16rem;
	font-weight: 400;
	overflow: hidden
}

#header .header_content .left[data-v-7fd5ad9d] {
	position: absolute;
	top: 0;
	left: .2rem
}

#header .header_content .right[data-v-7fd5ad9d] {
	position: absolute;
	top: .1rem;
	right: .2rem
}

#header .header_content .left a[data-v-7fd5ad9d] {
	color: #fff;
	line-height: .5rem;
	font-size: .2rem
}

.arrow_left[data-v-7fd5ad9d]:after, .arrow_white[data-v-7fd5ad9d]:after {
	content: " ";
	display: inline-block;
	-webkit-transform: rotate(225deg);
	-ms-transform: rotate(225deg);
	transform: rotate(225deg);
	height: .17rem;
	width: .17rem;
	border-width: .02rem .02rem 0 0;
	border-style: solid;
	top: -.02rem;
	position: absolute;
	left: 0;
	top: .19rem
}

.arrow_left[data-v-7fd5ad9d]:after {
	border-color: #ffbf23;
}

.cap {
	color: #2187f7 !important;
}
#smscode {
	background: none !important;
}
</style>
</head>
<body data-n-head="">
<div id="__nuxt">
	<div class="progress" data-v-4a8a9a01="" style="width:0;height:2px;background-color:#012861;opacity:0"></div>
	<div data-v-221d2783="">
		<div id="header" data-v-7fd5ad9d="" data-v-221d2783="">
			<div class="header_content" data-v-7fd5ad9d=""><h3 data-v-7fd5ad9d=""></h3>
				<div class="left" data-v-7fd5ad9d="" onclick="window.history.back();"><a class="arrow_left" data-v-7fd5ad9d=""></a></div><!----></div>
		</div>
		<div class="login_content" data-v-221d2783="">
			<h2 data-v-221d2783="">{$Think.lang.re_pwd}</h2>
			<div class="login_form" data-v-221d2783="">
				<div class="ipt-group" data-v-221d2783="">
					<label data-v-221d2783="">
						<input class="email" type="email" placeholder="{$Think.lang.input_mailbox}"  data-v-221d2783="">
						<i class="icon icon_tel" style="display:none" data-v-221d2783=""></i>
					</label>
				</div>
				<div class="ipt-group" data-v-221d2783="">
					<label data-v-221d2783="">
						<input class="qrcode" type="tel" placeholder="{$Think.lang.verification_code}" maxlength="6" data-v-221d2783="" id="smscode">
						<i class="captcha getqrcode" data-v-221d2783="">{$Think.lang.send_code}</i>
					</label>
				</div>
				
				<div class="ipt-group" data-v-221d2783="">
					<label data-v-221d2783="">
						<input  type="password" placeholder="{$Think.lang.input_password}"  data-v-221d2783="" id="password">
					</label>
				</div>
			
			</div>
			<div class="login_btn" data-v-221d2783=""><span data-v-221d2783="" class="activeColor" onclick="submit();">{$Think.lang.submit}</span></div>
		</div>
	</div>
</div>
<script src="__PUBLIC__/Qts/Home/js/jquery.js"></script>
<script type="text/javascript" src="__PUBLIC__/Home/css/layer/layer.js"></script>
<script type="text/javascript" src="__PUBLIC__/Qts/Home/js/appAlert.js"></script>
<script>
    $('.email').keyup(function () {
        var email   = $(this).val();
        var reg     = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
        if(reg.test(email)) {
            $('.getqrcode').addClass('cap');
        } else {
            $('.getqrcode').removeClass('cap');
        }
    });

    //验证码
    $('label').on('click','.cap',getCode);
    function getCode() {
        var email = $('.email').val();
        get_email_code(email);
    }

    function get_email_code(email) {
        try{
            showProgress();
        }catch(e){
            var index = layer.load(2);
        }

        $.ajax({
            url:"{:U('Tools/outpwd_emailverify')}",
            dataType: 'json',
            type: 'get',
            data: {'email':email},
            success:function(data){

                try{
                    closeProgress();
                }catch(e){
                    layer.close(index);
                }
                if(data.ret_code == 200){

                    try{
                        alertMessage(data.ret_msg,1000);
                    }catch(e){
                        layer.msg(data.ret_msg);
                    }
                    return mbtime();
                } else{
                    try{
                        return alertMessage(data.ret_msg,1000);
                    }catch(e){
                        return layer.msg(data.ret_msg);
                    }
                }
            }
        });
    }

    function mbtime()
    {
        var s=60;
        var timer=setInterval(function () {
            s--;
            $('.getqrcode').html(s+'{$Think.lang.second}').removeClass('cap');
            $('.getqrcode').unbind('click');
            if(s==0){
                $('.getqrcode').html('{$Think.lang.send_code}').addClass('cap');
                $('.getqrcode').bind('click',getCode)
                clearInterval(timer)
                timer=null;
            }
        },1000);
    }


    //信息提交
    function submit()
    {
        try{
            showProgress();
        }catch(e){
            var index = layer.load(2);
        }

        var email       = $('.email').val();
        var password    = $('#password').val();
        var smscode     = $('#smscode').val();

        $.ajax({
            url:"{:U('Register/outpwd')}",
            dataType: 'json',
            type: 'post',
            data: {'email':email,'password':password,'smscode':smscode},
            success:function(data){

                try{
                    closeProgress();
                }catch(e){
                    layer.close(index);
                }
                if(data.code == 200){

                    try{
                        alertMessage(data.msg,1000);
                    }catch(e){
                        layer.msg(data.msg);
                    }
                    return setTimeout(" window.location.href='{:U('Login/login')}'",500);
                } else{
                    try{
                        return alertMessage(data.msg,1000);
                    }catch(e){
                        return layer.msg(data.msg);
                    }
                }
            }
        });
    }


</script>
</body>
</html>